(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{12:function(e,t,n){"use strict";function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return i}));class i{constructor({items:e=[]}={}){s(this,"element",void 0),s(this,"onPointerDown",e=>{if(1!==e.which)return;const t=e.target.closest(".sortable-list__item");t&&(e.target.closest("[data-grab-handle]")&&(e.preventDefault(),this.dragStart(t,e)),e.target.closest("[data-delete-handle]")&&(e.preventDefault(),t.remove()))}),s(this,"onPointerMove",({clientX:e,clientY:t})=>{var n;this.moveDraggingItem(e,t),this.draggingItem.style.display="none";const s=null===(n=document.elementFromPoint(e,t))||void 0===n?void 0:n.closest(".sortable-list__item");this.draggingItem.style.display="";const i=[...this.element.children],r=i.indexOf(s),o=i.indexOf(this.placeholder);-1!==r&&-1!==o&&(o<r?s.after(this.placeholder):s.before(this.placeholder))}),s(this,"onPointerUp",()=>{this.dragStop()}),this.items=e,this.render(),this.initEventListners()}render(){this.element=document.createElement("ul"),this.element.className="sortable-list",this.items.forEach(e=>e.classList.add("sortable-list__item")),this.element.append(...this.items)}initEventListners(){this.element.addEventListener("pointerdown",this.onPointerDown)}dragStart(e,{clientX:t,clientY:n}){const{left:s,top:i,width:r,height:o}=e.getBoundingClientRect();this.itemStartIndex=[...this.element.children].indexOf(e),this.placeholder=document.createElement("li"),this.placeholder.className="sortable-list__placeholder",this.placeholder.style.width=r+"px",this.placeholder.style.height=o+"px",this.draggingItem=e,this.draggingItem.classList.add("sortable-list__item_dragging"),this.draggingItem.style.width=r+"px",this.draggingItem.style.height=o+"px",this.draggingItem.before(this.placeholder),this.element.append(this.draggingItem),this.pointerOffset={x:t-s,y:n-i},this.moveDraggingItem(t,n),document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp)}moveDraggingItem(e,t){this.draggingItem.style.left=e-this.pointerOffset.x+"px",this.draggingItem.style.top=t-this.pointerOffset.y+"px"}dragStop(){const e=[...this.element.children].indexOf(this.placeholder);this.placeholder.replaceWith(this.draggingItem),this.draggingItem.classList.remove("sortable-list__item_dragging"),this.draggingItem.style.left="",this.draggingItem.style.top="",this.draggingItem.style.width="",this.draggingItem.style.height="",document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp),this.draggingItem=null,e!==this.itemStartIndex&&this.element.dispatchEvent(new CustomEvent("sortable-list-reorder",{bubbles:!0,details:{from:this.itemStartIndex,to:e}}))}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerMove),this.element=null}}},13:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));class s{constructor(e="",{duration:t=2e3,type:n="success"}={}){if(this.type={success:"success",error:"error"}[n],!this.type)throw new Error("Invalid type specified");this.message=e,this.duration=t,this.render()}get template(){return`\n      <div class="notification ${this.type}" style="--value:${(this.duration/1e3).toFixed(0)}s">\n        <div class="inner-wrapper">\n          <div class="notification-body">${this.message}</div>\n        </div>\n        <div class="timer"></div>\n      </div>\n    `}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild}show(e=document.body){var t;const n=this.constructor.activeComponent;clearTimeout(n.timeoutId),null===(t=n.component)||void 0===t||t.remove(),n.component=e.append(this.element),n.timeoutId=setTimeout(()=>this.remove(),this.duration)}remove(){this.element.remove()}destroy(){this.remove()}}var i,r,o;o={timeoutId:null,component:null},(r="activeComponent")in(i=s)?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o},6:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var s=n(12);class i{constructor(e=[]){var t,n,s;s=void 0,(n="element")in(t=this)?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.categories=e,this.render(),this.initEventListners()}render(){this.element=document.createElement("div"),this.element.className="categories",this.categories.forEach(e=>{this.element.append(this.createCategory(e))})}initEventListners(){this.element.addEventListener("click",e=>{const t=e.target.closest(".category__header");if(t){t.closest(".category").classList.toggle("category_open")}})}createCategory(e){const t=document.createElement("div");t.innerHTML=`\n      <div class="category category_open" data-id="${e.id}">\n        <header class="category__header">\n          ${e.title}\n        </header>\n        <div class="category__body">\n          <div class="subcategory-list"></div>\n        </div>\n      </div>\n    `;const n=t.firstElementChild,s=this.createSubcategoryList(e.subcategories);return n.querySelector(".subcategory-list").append(s),n}createSubcategoryList(e=[]){return new s.a({items:e.map(e=>this.createSubcategoryItem(e))}).element}createSubcategoryItem(e){const t=document.createElement("div");return t.innerHTML=`\n      <li class="categories__sortable-list-item sortable-list__item" data-grab-handle="" data-id="${e.id}">\n        <strong>${e.title}</strong>\n        <span><b>${e.count}</b> products</span>\n      </li>\n    `,t.firstElementChild}remove(){this.element.remove()}destroy(){this.remove(),this.element=null}}var r=n(13),o=n(9);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l{constructor(){a(this,"element",void 0),a(this,"subElements",{}),a(this,"components",{})}get template(){return'\n      <div class="categories">\n        <div class="content__top-panel">\n          <h1 class="page-title">Категории товаров</h1>\n        </div>\n        <div data-element="categoriesContainer"></div>\n      </div>\n    '}async render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(),await this.initComponents(),this.renderComponents(),this.initEventListners(),this.element}async initComponents(){const e=await this.loadCategories(),t=new i(e);this.components={categoriesContainer:t}}loadCategories(){const e=new URL("/api/rest/categories","https://course-js.javascript.ru/");return e.searchParams.set("_sort","weight"),e.searchParams.set("_refs","subcategory"),Object(o.a)(e)}renderComponents(){Object.keys(this.components).forEach(e=>{const t=this.subElements[e],{element:n}=this.components[e];t.append(n)})}initEventListners(){const e=new r.a("Порядок изменен",{duration:2e3,type:"success"});this.element.addEventListener("sortable-list-reorder",t=>{e.show()})}getSubElements(){return[...this.element.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}remove(){this.element.remove()}destroy(){for(const e of Object.values(this.components))e.destroy();this.remove(),this.element=null,this.subElements=null,this.components=null}}},9:function(e,t,n){"use strict";t.a=async function(e,t){let n,i;try{n=await fetch(e.toString(),t)}catch(e){throw new s(n,"Network error has occurred.")}if(!n.ok){let e=n.statusText;try{i=await n.json(),e=i.error&&i.error.message||i.data&&i.data.error&&i.data.error.message||e}catch(e){}let t=`Error ${n.status}: ${e}`;throw new s(n,i,t)}try{return await n.json()}catch(e){throw new s(n,null,e.message)}};class s extends Error{constructor(e,t,n){var s,i,r;super(n),r="FetchError",(i="name")in(s=this)?Object.defineProperty(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof s&&alert(e.reason.message)})}}]);
//# sourceMappingURL=categories-index-js-1.js.map