{"version":3,"sources":["webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js","webpack:///./src/utils/fetch-json.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/notification/index.js"],"names":["ProductForm","constructor","productId","title","description","images","subcategory","status","quantity","price","discount","event","preventDefault","this","save","fileInput","document","createElement","hidden","type","accept","addEventListener","async","file","files","formData","FormData","uploadImage","imageListContainer","subElements","imageList","children","append","classList","add","disabled","result","fetchJson","URL","method","headers","Authorization","body","createImageListItem","data","link","name","remove","click","target","dataset","closest","loadData","wrapper","innerHTML","product","template","emptyTemplate","element","firstElementChild","getSubElements","setFormData","initEventListners","categories","Promise","all","loadCategories","loadProducts","id","defaultProduct","url","process","searchParams","set","getSubcategoryOptions","createImageList","SortableList","items","map","source","escapeHtml","options","category","subcategories","option","Option","push","outerHTML","join","getFormData","JSON","stringify","dispatchEvent","error","console","getFields","excludes","Object","keys","filter","item","includes","productForm","forEach","querySelector","value","numbers","values","Number","querySelectorAll","eventType","CustomEvent","detail","bubbles","onSubmit","onUploadImage","onDeleteImage","reduce","accum","subElement","destroy","Page","_","initComponents","renderComponents","render","components","component","root","savedNotification","NotificationMessage","duration","show","updatedNotification","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","message","Error","super","window","reason","alert","string","replace","which","listItem","dragStart","clientX","clientY","moveDraggingItem","draggingItem","style","display","itemBelow","elementFromPoint","itemBelowIndex","indexOf","placeholderIndex","placeholder","after","before","dragStop","className","onPointerDown","left","top","width","height","getBoundingClientRect","itemStartIndex","pointerOffset","x","y","onPointerMove","onPointerUp","itemStopIndex","replaceWith","removeEventListener","details","from","to","success","toFixed","current","activeComponent","clearTimeout","timeoutId","setTimeout"],"mappings":"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","file":"products-edit-index-js-4.js","sourcesContent":["import SortableList from '../sortable-list'\r\n\r\nimport escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nconst URL_PATH = process.env.URL_PATH;\r\n\r\nexport default class ProductForm {\r\n  product;\r\n  defaultProduct = {\r\n    title: '',\r\n    description: '',\r\n    images: [],\r\n    subcategory: '',\r\n    status: 0,\r\n    quantity: 1,\r\n    price: 100,\r\n    discount: 0,\r\n  }\r\n  categories = [];\r\n  element;\r\n  subElements = {};\r\n  \r\n  onSubmit = event => {\r\n    event.preventDefault();\r\n    this.save();\r\n  };\r\n  \r\n  onUploadImage = () => {\r\n    const fileInput = document.createElement('input');\r\n    fileInput.hidden = true;\r\n    fileInput.type = 'file';\r\n    fileInput.accept = 'image/*';\r\n\r\n    fileInput.addEventListener('change', async () => {\r\n      const [file] = fileInput.files;\r\n\r\n      if (file) {\r\n        const formData = new FormData();\r\n        const { uploadImage, imageListContainer } = this.subElements;\r\n        const [imageList] = imageListContainer.children;\r\n\r\n        formData.append('image', file);\r\n        \r\n        uploadImage.classList.add('is-loading');\r\n        uploadImage.disabled = true;\r\n\r\n        const result = await fetchJson(new URL('https://api.imgur.com/3/image'), {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Client-ID ${process.env.IMGUR_CLIENT_ID}`,\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        imageList.append(this.createImageListItem(result.data.link, file.name));\r\n\r\n        uploadImage.classList.remove('is-loading');\r\n        uploadImage.disabled = false;\r\n\r\n        fileInput.remove();\r\n      }\r\n    });\r\n\r\n    document.body.append(fileInput);\r\n    fileInput.click();\r\n  };\r\n\r\n  onDeleteImage = event => {\r\n    if ('deleteHandle' in event.target.dataset) {\r\n      event.target.closest('li').remove();\r\n    }\r\n  };\r\n\r\n  constructor (productId) {\r\n    this.productId = productId;\r\n  }\r\n\r\n  async render() {\r\n    await this.loadData();\r\n\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.product ? this.template : this.emptyTemplate;\r\n    this.element = wrapper.firstElementChild;\r\n    this.subElements = this.getSubElements();\r\n\r\n    if (this.product) {\r\n      this.setFormData();\r\n      this.initEventListners();\r\n    }\r\n    \r\n    return this.element;\r\n  }\r\n\r\n  async loadData() {\r\n    const [categories, [product]] = await Promise.all([this.loadCategories(), this.loadProducts(this.productId)]);\r\n    this.categories = categories;\r\n    this.product = product;\r\n  }\r\n\r\n  loadProducts(id) {\r\n    if (!id) return [this.defaultProduct];\r\n    const url = new URL('/api/rest/products', process.env.BACKEND_URL);\r\n    url.searchParams.set('id', id);\r\n    return fetchJson(url);\r\n  }\r\n\r\n  loadCategories() {\r\n    const url = new URL('/api/rest/categories', process.env.BACKEND_URL);\r\n    url.searchParams.set('_sort', 'weight');\r\n    url.searchParams.set('_refs', 'subcategory');\r\n    return fetchJson(url);\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"product-form\">\r\n        <form data-element=\"productForm\" class=\"form-grid\">\r\n          <div class=\"form-group form-group__half_left\">\r\n            <fieldset>\r\n              <label class=\"form-label\">Название товара</label>\r\n              <input id=\"title\" required=\"\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\">\r\n            </fieldset>\r\n          </div>\r\n          <div class=\"form-group form-group__wide\">\r\n            <label class=\"form-label\">Описание</label>\r\n            <textarea id=\"description\" required=\"\" class=\"form-control\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\"></textarea>\r\n          </div>\r\n          <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\r\n            <label class=\"form-label\">Фото</label>\r\n            <div data-element=\"imageListContainer\"></div>\r\n            <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline fit-content\" data-element=\"uploadImage\"><span>Загрузить</span></button>\r\n          </div>\r\n          <div class=\"form-group form-group__half_left\">\r\n            <label class=\"form-label\">Категория</label>\r\n            <select id=\"subcategory\" class=\"form-control\" name=\"subcategory\">\r\n              ${this.getSubcategoryOptions(this.categories)}\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group form-group__half_left form-group__two-col\">\r\n            <fieldset>\r\n              <label class=\"form-label\">Цена ($)</label>\r\n              <input id=\"price\" required=\"\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"${this.defaultProduct.price}\">\r\n            </fieldset>\r\n            <fieldset>\r\n              <label class=\"form-label\">Скидка ($)</label>\r\n              <input id=\"discount\" required=\"\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"${this.defaultProduct.discount}\">\r\n            </fieldset>\r\n          </div>\r\n          <div class=\"form-group form-group__part-half\">\r\n            <label class=\"form-label\">Количество</label>\r\n            <input id=\"quantity\" required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"${this.defaultProduct.quantity}\">\r\n          </div>\r\n          <div class=\"form-group form-group__part-half\">\r\n            <label class=\"form-label\">Статус</label>\r\n            <select id=\"status\" class=\"form-control\" name=\"status\">\r\n              <option value=\"1\">Активен</option>\r\n              <option value=\"0\">Неактивен</option>\r\n            </select>\r\n          </div>\r\n          <div class=\"form-buttons\">\r\n            <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\r\n              ${this.productId ? 'Сохранить' : 'Добавить'} товар\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  get emptyTemplate() {\r\n    return `\r\n      <div class=\"product-form\">\r\n        <h1 class=\"page-title\">Страница не найдена</h1>\r\n        <p>Извините, данный товар не существует</p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  createImageList(images = []) {\r\n    const sortableList = new SortableList({\r\n      items: images.map(({ url, source }) => this.createImageListItem(url, source)),\r\n    });\r\n    return sortableList.element;\r\n  }\r\n\r\n  createImageListItem(url, source) {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = `\r\n      <li class=\"products-edit__imagelist-item sortable-list__item\" style=\"\">\r\n        <input type=\"hidden\" name=\"url\" value=\"${url}\">\r\n        <input type=\"hidden\" name=\"source\" value=\"${escapeHtml(source)}\">\r\n        <span>\r\n          <img src=\"/${URL_PATH}icons/icon-grab.svg\" data-grab-handle=\"\" alt=\"grab\">\r\n          <img class=\"sortable-table__cell-img\" alt=\"Image\" src=\"${url}\">\r\n          <span>${escapeHtml(source)}</span>\r\n        </span>\r\n        <button type=\"button\">\r\n          <img src=\"/${URL_PATH}icons/icon-trash.svg\" data-delete-handle=\"\" alt=\"delete\">\r\n        </button>\r\n      </li>\r\n    `;\r\n    return wrapper.firstElementChild;\r\n  }\r\n\r\n  getSubcategoryOptions(categories = []) {\r\n    const options = [];\r\n    for (const category of categories) {\r\n      for (const subcategory of category.subcategories) {\r\n        const option = new Option(`${category.title} > ${subcategory.title}`, subcategory.id);\r\n        options.push(option.outerHTML);\r\n      }\r\n    }\r\n    return options.join('');\r\n  }\r\n\r\n  async save() {\r\n    const product = this.getFormData();\r\n\r\n    try {\r\n      const result = await fetchJson(new URL('/api/rest/products', process.env.BACKEND_URL), {\r\n        method: this.productId ? 'PATCH' : 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(product),\r\n      });\r\n  \r\n      this.dispatchEvent(result.id);\r\n    } catch(error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n  \r\n  getFields() {\r\n    const excludes = ['images'];\r\n    return Object.keys(this.defaultProduct).filter(item => !excludes.includes(item));\r\n  }\r\n  \r\n  setFormData() {\r\n    const { productForm, imageListContainer } = this.subElements;\r\n\r\n    const imageList = this.createImageList(this.product.images);\r\n    imageListContainer.innerHTML = '';\r\n    imageListContainer.append(imageList);\r\n\r\n    this.getFields().forEach(item => {\r\n      const element = productForm.querySelector(`#${item}`);\r\n      element.value = this.product[item] || this.defaultProduct[item];\r\n    });\r\n  }\r\n\r\n  getFormData() {\r\n    const { productForm } = this.subElements;\r\n    const numbers = ['status', 'quantity', 'price', 'discount'];\r\n    const values = {};\r\n\r\n    if (this.productId) values.id = this.productId;\r\n\r\n    this.getFields().forEach(item => {\r\n      const element = productForm.querySelector(`#${item}`);\r\n      values[item] = numbers.includes(item) ? Number(element.value) : element.value;\r\n    });\r\n\r\n    values.images = [...productForm.querySelectorAll('.products-edit__imagelist-item')].map(item => ({\r\n      url: item.querySelector(`[name=\"url\"]`).value,\r\n      source: item.querySelector(`[name=\"source\"]`).value,\r\n    }));\r\n    \r\n    return values;\r\n  }\r\n  \r\n  dispatchEvent(id) {\r\n    const eventType = this.productId ? 'product-updated' : 'product-saved';\r\n    const event = new CustomEvent(eventType, { detail: id, bubbles: true });\r\n    this.element.dispatchEvent(event);\r\n  }\r\n\r\n  initEventListners() {\r\n    const { productForm, uploadImage, imageListContainer } =  this.subElements;\r\n    productForm.addEventListener('submit', this.onSubmit);\r\n    uploadImage.addEventListener('pointerdown', this.onUploadImage);\r\n    imageListContainer.addEventListener('pointerdown', this.onDeleteImage)\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll('[data-element]');\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = null;\r\n  }\r\n}\r\n","import ProductForm from '../../../components/product-form';\r\nimport NotificationMessage from '../../../components/notification';\r\n\r\nconst URL_PATH = process.env.URL_PATH;\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n\r\n  constructor([_, productId]) {\r\n    this.productId = productId;\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"products-edit\">\r\n        <div class=\"content__top-panel\">\r\n          <h1 class=\"page-title\">\r\n            <a href=\"/${URL_PATH}products\" class=\"link\">Товары</a> / Редактировать\r\n          </h1>\r\n        </div>\r\n        <div class=\"content-box\" data-element=\"productForm\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  async render() {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements();\r\n\r\n    await this.initComponents();\r\n    this.renderComponents();\r\n    this.initEventListners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  async initComponents() {\r\n    const productForm = new ProductForm(this.productId);\r\n    await productForm.render();\r\n\r\n    this.components = {\r\n      productForm,\r\n    };\r\n  }\r\n\r\n  renderComponents() {\r\n    Object.keys(this.components).forEach(component => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n\r\n      root.append(element);\r\n    });\r\n  }\r\n\r\n  initEventListners() {\r\n    const savedNotification = new NotificationMessage('Товар добавлен', { duration: 2000, type: 'success' });\r\n    this.element.addEventListener('product-saved', event => {\r\n      savedNotification.show();\r\n    });\r\n\r\n    const updatedNotification = new NotificationMessage('Товар сохранен', { duration: 2000, type: 'success' });\r\n    this.element.addEventListener('product-updated', event => {\r\n      updatedNotification.show();\r\n    });\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll('[data-element]');\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n\r\n    this.remove();\r\n\r\n    this.element = null;\r\n    this.subElements = null;\r\n    this.components = null;\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","export default class SortableList {\r\n  element;\r\n\r\n  onPointerDown = event => {\r\n    if (event.which !== 1) return;\r\n    const listItem = event.target.closest('.sortable-list__item');\r\n\r\n    if (listItem) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n        this.dragStart(listItem, event);\r\n      }\r\n\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n        listItem.remove();\r\n      }\r\n    }\r\n  };\r\n\r\n  onPointerMove = ({ clientX, clientY }) => {\r\n    this.moveDraggingItem(clientX, clientY);\r\n\r\n    this.draggingItem.style.display = 'none';\r\n    const itemBelow = document.elementFromPoint(clientX, clientY)?.closest('.sortable-list__item');\r\n    this.draggingItem.style.display = '';\r\n    \r\n    const children = [...this.element.children];\r\n    const itemBelowIndex = children.indexOf(itemBelow);\r\n    const placeholderIndex = children.indexOf(this.placeholder);\r\n    if (itemBelowIndex === -1 || placeholderIndex === -1) return;\r\n\r\n    if (placeholderIndex < itemBelowIndex) {\r\n      itemBelow.after(this.placeholder);\r\n    } else {\r\n      itemBelow.before(this.placeholder);\r\n    }\r\n  };\r\n\r\n  onPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  constructor({ items = [] } = {}) {\r\n    this.items = items;\r\n    \r\n    this.render();\r\n    this.initEventListners();\r\n  }\r\n\r\n  render() {\r\n    this.element = document.createElement('ul');\r\n    this.element.className = 'sortable-list';\r\n    this.items.forEach(item => item.classList.add('sortable-list__item'));\r\n    this.element.append(...this.items);\r\n  }\r\n\r\n  initEventListners() {\r\n    this.element.addEventListener('pointerdown', this.onPointerDown);\r\n  }\r\n\r\n  dragStart(listItem, { clientX, clientY }) {\r\n    const { left, top, width, height } = listItem.getBoundingClientRect();\r\n    this.itemStartIndex = [...this.element.children].indexOf(listItem);\r\n\r\n    this.placeholder = document.createElement('li');\r\n    this.placeholder.className = 'sortable-list__placeholder';\r\n    this.placeholder.style.width = width + 'px';\r\n    this.placeholder.style.height = height + 'px';\r\n\r\n    this.draggingItem = listItem;\r\n    this.draggingItem.classList.add('sortable-list__item_dragging');\r\n    this.draggingItem.style.width = width + 'px';\r\n    this.draggingItem.style.height = height + 'px';\r\n    this.draggingItem.before(this.placeholder);\r\n\r\n    this.element.append(this.draggingItem);\r\n\r\n    this.pointerOffset = {\r\n      x: clientX - left,\r\n      y: clientY - top,\r\n    };\r\n\r\n    this.moveDraggingItem(clientX, clientY);\r\n\r\n    document.addEventListener('pointermove', this.onPointerMove);\r\n    document.addEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  moveDraggingItem(clientX, clientY) {\r\n    this.draggingItem.style.left = clientX - this.pointerOffset.x + 'px';\r\n    this.draggingItem.style.top = clientY - this.pointerOffset.y + 'px';\r\n  }\r\n\r\n  dragStop() {\r\n    const itemStopIndex = [...this.element.children].indexOf(this.placeholder);\r\n    this.placeholder.replaceWith(this.draggingItem);\r\n    this.draggingItem.classList.remove('sortable-list__item_dragging');\r\n\r\n    this.draggingItem.style.left = '';\r\n    this.draggingItem.style.top = '';\r\n    this.draggingItem.style.width = '';\r\n    this.draggingItem.style.height = '';\r\n\r\n    document.removeEventListener('pointermove', this.onPointerMove);\r\n    document.removeEventListener('pointerup', this.onPointerUp);\r\n\r\n    this.draggingItem = null;\r\n    \r\n    if (itemStopIndex !== this.itemStartIndex) {\r\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\r\n        bubbles: true,\r\n        details: {\r\n          from: this.itemStartIndex,\r\n          to: itemStopIndex,\r\n        }\r\n      }))\r\n    }\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    document.removeEventListener('pointermove', this.onPointerMove);\r\n    document.removeEventListener('pointerup', this.onPointerMove);\r\n    this.element = null;\r\n  }\r\n}\r\n","export default class NotificationMessage {\r\n  static activeComponent = {\r\n    timeoutId: null,\r\n    component: null,\r\n  }; \r\n\r\n  constructor(message = '', {\r\n    duration = 2000,\r\n    type = 'success',\r\n  } = {}) {\r\n    const types = {\r\n      success: 'success',\r\n      error: 'error',\r\n    };\r\n    this.type = types[type];\r\n    if (!this.type) throw new Error('Invalid type specified');\r\n\r\n    this.message = message;\r\n    this.duration = duration;\r\n\r\n    this.render();\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"notification ${this.type}\" style=\"--value:${(this.duration / 1000).toFixed(0)}s\">\r\n        <div class=\"inner-wrapper\">\r\n          <div class=\"notification-body\">${this.message}</div>\r\n        </div>\r\n        <div class=\"timer\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  render() {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n  }\r\n\r\n  show(target = document.body) {\r\n    const current = this.constructor.activeComponent;\r\n    clearTimeout(current.timeoutId);\r\n    current.component?.remove();\r\n    current.component = target.append(this.element);\r\n    current.timeoutId = setTimeout(() => this.remove(), this.duration);\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}\r\n"],"sourceRoot":""}