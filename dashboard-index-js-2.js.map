{"version":3,"sources":["webpack:///./src/components/column-chart/index.js","webpack:///./src/pages/dashboard/bestsellers-header.js","webpack:///./src/pages/dashboard/index.js","webpack:///./src/utils/fetch-json.js","webpack:///./src/components/sortable-table/index.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/range-picker/index.js"],"names":["ColumnChart","constructor","url","range","from","Date","to","label","link","formatHeading","data","formatTooltip","key","value","this","URL","process","render","initEventListners","loadData","chartHeight","header","body","Object","values","reduce","accum","item","max","Math","entries","map","floor","join","wrapper","document","createElement","innerHTML","template","element","firstElementChild","subElements","getSubElements","addEventListener","event","target","dataset","tooltip","classList","add","remove","querySelectorAll","subElement","searchParams","set","toISOString","fetchJson","length","destroy","id","title","sortable","sortType","escapeHtml","category","subcategory","customSorting","a","b","localeCompare","caseFirst","Page","initComponents","renderComponents","components","rangePicker","detail","updateComponents","sortableTable","update","ordersChart","salesChart","customersChart","setMonth","getMonth","RangePicker","SortableTable","sorted","order","start","end","isSortLocally","toLocaleDateString","year","month","day","toLocaleString","keys","forEach","component","root","append","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","message","status","Error","super","window","reason","alert","headerConfig","find","step","placeholder","column","closest","next","asc","desc","sort","async","bottom","getBoundingClientRect","documentElement","clientHeight","loading","addRows","filter","delete","renderRows","getHeader","getBody","getRow","row","onSortClick","onWindowScroll","sortLocally","sortOnServer","sortedData","sortData","direction","push","rows","childNodes","removeEventListener","string","replace","date","dateStyle","isOpen","contains","isRangePicker","close","showDateFrom","selected","formatDate","initEventListeners","input","selector","onDocumentClick","toggle","onSelectorClick","renderDateRangePicker","onRangePickerCellClick","showDate1","showDate2","renderCalendar","controlLeft","querySelector","controlRight","prev","renderHighlight","cell","cellDate","selectedFromElem","selectedToElem","showDate","setDate","monthStr","table","dayIndex","getDay","getDate","dateValue","selectingFrom","dispatchEvent","CustomEvent","bubbles"],"mappings":"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","file":"dashboard-index-js-2.js","sourcesContent":["import fetchJson from '../../utils/fetch-json.js';\r\n\r\nexport default class ColumnChart {\r\n  element;\r\n  subElements = {};\r\n  chartHeight = 50;\r\n  data = {};\r\n\r\n  constructor({\r\n    url = '',\r\n    range = {\r\n      from: new Date(),\r\n      to: new Date(),\r\n    },\r\n    label = '',\r\n    link = '',\r\n    formatHeading = data => data,\r\n    formatTooltip = (key, value) => `<b>${value}</b>`,\r\n  } = {}) {\r\n    this.url = new URL(url, process.env.BACKEND_URL);\r\n    this.range = range;\r\n    this.label = label;\r\n    this.link = link;\r\n    this.formatHeading = formatHeading;\r\n    this.formatTooltip = formatTooltip;\r\n    \r\n    this.render();\r\n    this.initEventListners();\r\n    this.loadData(this.range.from, this.range.to);\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"column-chart\" style=\"--chart-height: ${this.chartHeight}\">\r\n        <div class=\"column-chart__title\">\r\n          ${this.label}\r\n          ${this.link ? `<a href=\"/${this.link}\" class=\"column-chart__link\">Подробнее</a>` : ''}\r\n        </div>\r\n        <div class=\"column-chart__container\">\r\n          <div data-element=\"header\" class=\"column-chart__header\">${this.header}</div>\r\n          <div data-element=\"body\" class=\"column-chart__chart\">${this.body}</div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  get header() {\r\n    return this.formatHeading(Object.values(this.data).reduce((accum, item) => (accum + item), 0));\r\n  }\r\n\r\n  get body() {\r\n    const values = Object.values(this.data);\r\n    const max = Math.max(...values);\r\n   \r\n    return Object.entries(this.data).map(([key, value]) => `\r\n      <div style=\"--value: ${Math.floor(value / max * this.chartHeight)}\" data-tooltip=\"${this.formatTooltip(key, value)}\"></div>\r\n    `).join('');\r\n  }\r\n\r\n  render() {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements();\r\n  }\r\n\r\n  initEventListners() {\r\n    const { body } = this.subElements;\r\n    body.addEventListener('pointerover', event => {\r\n      if (event.target.dataset.tooltip) {\r\n        body.classList.add('has-hovered');\r\n        event.target.classList.add('is-hovered');\r\n      }\r\n    });\r\n    body.addEventListener('pointerout', event => {\r\n      if (event.target.dataset.tooltip) {\r\n        body.classList.remove('has-hovered');\r\n        event.target.classList.remove('is-hovered');\r\n      }\r\n    });\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll('[data-element]');\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  async loadData(from, to) {\r\n    this.element.classList.add('column-chart_loading');\r\n    this.subElements.header.innerHTML = '';\r\n    this.subElements.body.innerHTML = '';\r\n\r\n    this.url.searchParams.set('from', from.toISOString());\r\n    this.url.searchParams.set('to', to.toISOString());\r\n    const data = await fetchJson(this.url);\r\n    \r\n    if (data && Object.values(data).length) {\r\n      this.data = data;\r\n      this.subElements.header.innerHTML = this.header;\r\n      this.subElements.body.innerHTML = this.body;\r\n      this.element.classList.remove('column-chart_loading');\r\n    }\r\n  }\r\n  \r\n  async update(from, to) {\r\n    return await this.loadData(from, to);\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}\r\n","import escapeHtml from '../../utils/escape-html.js';\r\n\r\nconst getSubcategoryTooltip = (category, subcategory) => `\r\n  <div class=\"sortable-table-tooltip\">\r\n    <span class=\"sortable-table-tooltip__category\">${category}</span> / <b class=\"sortable-table-tooltip__subcategory\">${subcategory}</b>\r\n  </div>\r\n`;\r\n\r\nconst header = [\r\n  {\r\n    id: 'images',\r\n    title: 'Фото',\r\n    sortable: false,\r\n    template: data => {\r\n      return `\r\n        <div class=\"sortable-table__cell\">\r\n          <img class=\"sortable-table-image\" alt=\"Image\" src=\"${data[0].url}\">\r\n        </div>\r\n      `;\r\n    }\r\n  },\r\n  {\r\n    id: 'title',\r\n    title: 'Название',\r\n    sortable: true,\r\n    sortType: 'string'\r\n  },\r\n  {\r\n    id: 'subcategory',\r\n    title: 'Категория',\r\n    sortable: true,\r\n    sortType: 'custom',\r\n    template: data => {\r\n      return `\r\n        <div class=\"sortable-table__cell\">\r\n          <span data-tooltip=\"${escapeHtml(getSubcategoryTooltip(data.category.title, data.title))}\">${data.title}</span>\r\n        </div>\r\n      `;\r\n    },\r\n    customSorting: (a, b) => a.subcategory.title.localeCompare(b.subcategory.title, ['ru', 'en'], { caseFirst: 'upper' }),\r\n  },\r\n  {\r\n    id: 'quantity',\r\n    title: 'Количество',\r\n    sortable: true,\r\n    sortType: 'number'\r\n  },\r\n  {\r\n    id: 'price',\r\n    title: 'Цена',\r\n    sortable: true,\r\n    sortType: 'number',\r\n    template: data => {\r\n      return `\r\n        <div class=\"sortable-table__cell\">\r\n          <span>$${data}</span>\r\n        </div>\r\n      `;\r\n    },\r\n  },\r\n  {\r\n    id: 'sales',\r\n    title: 'Продажи',\r\n    sortable: true,\r\n    sortType: 'number'\r\n  },\r\n];\r\n\r\nexport default header;\r\n","import RangePicker from '../../components/range-picker';\r\nimport SortableTable from '../../components/sortable-table';\r\nimport ColumnChart from '../../components/column-chart';\r\nimport header from './bestsellers-header.js';\r\n\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nconst URL_PATH = process.env.URL_PATH;\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"dashboard\">\r\n        <div class=\"content__top-panel\">\r\n          <h2 class=\"page-title\">Панель управления</h2>\r\n          <div data-element=\"rangePicker\"></div>\r\n        </div>\r\n        <div class=\"dashboard__charts\">\r\n          <div class=\"dashboard__chart_orders\" data-element=\"ordersChart\"></div>\r\n          <div class=\"dashboard__chart_sales\" data-element=\"salesChart\"></div>\r\n          <div class=\"dashboard__chart_customers\" data-element=\"customersChart\"></div>\r\n        </div>\r\n        <h3 class=\"block-title\">Лидеры продаж</h3>\r\n        <div data-element=\"sortableTable\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  render() {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements();\r\n\r\n    this.initComponents();\r\n    this.renderComponents();\r\n    this.initEventListners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  initEventListners() {\r\n    this.components.rangePicker.element.addEventListener('date-select', event => {\r\n      const { from, to } = event.detail;\r\n\r\n      this.updateComponents(from, to);\r\n    });\r\n  }\r\n\r\n  async updateComponents(from, to) {\r\n    const url = new URL('api/dashboard/bestsellers', process.env.BACKEND_URL);\r\n    url.searchParams.set('_start', 0);\r\n    url.searchParams.set('_end', 30);\r\n    url.searchParams.set('from', from.toISOString());\r\n    url.searchParams.set('to', to.toISOString());\r\n    url.searchParams.set('_sort', 'sales');\r\n    url.searchParams.set('_order', 'desc');\r\n\r\n    const data = await fetchJson(url);\r\n\r\n    this.components.sortableTable.update(data);\r\n    this.components.ordersChart.update(from, to);\r\n    this.components.salesChart.update(from, to);\r\n    this.components.customersChart.update(from, to);\r\n  }\r\n\r\n  initComponents() {    \r\n    const to = new Date();\r\n    const from = new Date();\r\n    from.setMonth(from.getMonth() - 1);\r\n\r\n    const rangePicker = new RangePicker({ from, to });\r\n\r\n    const sortableTable = new SortableTable(header, {\r\n      url: `api/dashboard/bestsellers?from=${from.toISOString()}&to=${to.toISOString()}`,\r\n      sorted: {\r\n        id: 'sales',\r\n        order: 'desc',\r\n      },\r\n      start: 0,\r\n      end: 30,\r\n      isSortLocally: true,\r\n    });\r\n\r\n    const formatTooltip = (key, value) => `\r\n      <div>\r\n        <small>${(new Date(key)).toLocaleDateString('ru-RU', { year: 'numeric', month: 'short', day: 'numeric' })}</small>\r\n      </div>\r\n      <strong>${value}</strong>\r\n    `;\r\n\r\n    const ordersChart = new ColumnChart({\r\n      url: 'api/dashboard/orders',\r\n      range: {\r\n        from,\r\n        to,\r\n      },\r\n      label: 'Заказы',\r\n      link: `${URL_PATH}sales`,\r\n      formatTooltip,\r\n    });\r\n\r\n    const salesChart = new ColumnChart({\r\n      url: 'api/dashboard/sales',\r\n      range: {\r\n        from,\r\n        to,\r\n      },\r\n      label: 'Продажи',\r\n      formatHeading: data => `$${data.toLocaleString('en-US')}`,\r\n      formatTooltip: (key, value) => `\r\n        <div>\r\n          <small>${(new Date(key)).toLocaleDateString('ru-RU', { year: 'numeric', month: 'short', day: 'numeric' })}</small>\r\n        </div>\r\n        <strong>$${value.toLocaleString('en-US')}</strong>\r\n      `,\r\n    });\r\n\r\n    const customersChart = new ColumnChart({\r\n      url: 'api/dashboard/customers',\r\n      range: {\r\n        from,\r\n        to,\r\n      },\r\n      label: 'Клиенты',\r\n      formatTooltip,\r\n    });\r\n\r\n    this.components = {\r\n      rangePicker,\r\n      sortableTable,\r\n      ordersChart,\r\n      salesChart,\r\n      customersChart,\r\n    };\r\n  }\r\n\r\n  renderComponents() {\r\n    Object.keys(this.components).forEach(component => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n\r\n      root.append(element);\r\n    });\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll('[data-element]');\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n\r\n    this.remove();\r\n\r\n    this.element = null;\r\n    this.subElements = null;\r\n    this.components = null;\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n","import fetchJson from '../../utils/fetch-json.js';\r\n\r\nconst URL_PATH = process.env.URL_PATH;\r\n\r\nexport default class SortableTable {\r\n  element;\r\n  subElements = {};\r\n  data = [];\r\n  loading = false;\r\n\r\n  onSortClick = event => {\r\n    const column = event.target.closest('[data-sortable]');\r\n    if (column) {\r\n      const { id, order } = column.dataset;\r\n      const next = {\r\n        asc: 'desc',\r\n        desc: 'asc',\r\n        '': 'desc',\r\n      };\r\n      this.sort(id, next[order]);\r\n    }\r\n  };\r\n\r\n  onWindowScroll = async () => {\r\n    const { bottom } = this.element.getBoundingClientRect();\r\n\r\n    if (bottom < document.documentElement.clientHeight && !this.loading && !this.isSortLocally) {\r\n      const { id, order } = this.sorted;\r\n      this.start = this.end;\r\n      this.end = this.start + this.step;\r\n      this.loading = true;\r\n      const data = await this.loadData(id, order, this.start, this.end);\r\n      this.addRows(data);\r\n      this.loading = false;\r\n    }\r\n  };\r\n\r\n  constructor(headerConfig = [], {\r\n    url = '',\r\n    sorted = {\r\n      id: headerConfig.find(item => item.sortable).id,\r\n      order: 'asc',\r\n    },\r\n    isSortLocally = false,\r\n    step = 20,\r\n    start = 0,\r\n    end = start + step,\r\n    placeholder = 'Не найдено',\r\n  } = {}) {\r\n    this.headerConfig = headerConfig;\r\n    this.url = new URL(url, process.env.BACKEND_URL);\r\n    this.sorted = sorted;\r\n    this.isSortLocally = isSortLocally;\r\n    this.step = step;\r\n    this.start = start;\r\n    this.end = end;\r\n    this.placeholder = placeholder;\r\n\r\n    this.render();\r\n  }\r\n\r\n  async setFilter(filter = {}) {\r\n    for (const key of this.url.searchParams.keys()) {\r\n      this.url.searchParams.delete(key);\r\n    }\r\n    Object.entries(filter).forEach(([key, value]) => {\r\n      this.url.searchParams.set(key, value);\r\n    });\r\n    const { id, order } = this.sorted;\r\n    this.start = 0;\r\n    this.end = this.start + this.step;\r\n    this.subElements.body.innerHTML = '';\r\n    this.data = await this.loadData(id, order, this.start, this.end);\r\n    this.renderRows(this.data);\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"sortable-table\">\r\n        <div data-element=\"header\" class=\"sortable-table__header sortable-table__row\">\r\n          ${this.getHeader()}\r\n        </div>\r\n        <div data-element=\"body\" class=\"sortable-table__body\">\r\n          ${this.getBody()}\r\n        </div>\r\n        <div data-element=\"loading\" class=\"loading-line sortable-table__loading-line\"></div>\r\n        <div data-element=\"emptyPlaceholder\" class=\"sortable-table__empty-placeholder\">${this.placeholder}</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getHeader() {\r\n    return this.headerConfig.map(item => `\r\n      <div class=\"sortable-table__cell\" data-id=\"${item.id}\" ${item.sortable ? 'data-sortable' : ''} data-order=\"${item.id === this.sorted.id ? this.sorted.order : ''}\">\r\n        <span>${item.title}</span>\r\n        <span data-element=\"arrow\" class=\"sortable-table__sort-arrow\">\r\n          <span class=\"sort-arrow\"></span>\r\n        </span>\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  getBody(data = []) {\r\n    return data.map(item => `\r\n      <a href=\"/${URL_PATH}products/${item.id}\" class=\"sortable-table__row\">\r\n        ${this.getRow(item)}\r\n      </a>\r\n    `).join('');\r\n  }\r\n\r\n  getRow(row) {\r\n    return this.headerConfig.map(item => item.template ? item.template(row[item.id]) : `\r\n      <div class=\"sortable-table__cell\">${row[item.id]}</div>\r\n    `).join('');\r\n  }\r\n\r\n  async render() {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n    \r\n    this.subElements = this.getSubElements();\r\n\r\n    const { id, order } = this.sorted;\r\n    this.data = await this.loadData(id, order, this.start, this.end);\r\n    this.renderRows(this.data);\r\n\r\n    this.initEventListners();\r\n  }\r\n\r\n  renderRows(data) {\r\n    if (data.length) {\r\n      this.element.classList.remove('sortable-table_empty');\r\n      this.subElements.body.innerHTML = this.getBody(data);\r\n    } else {\r\n      this.element.classList.add('sortable-table_empty');\r\n    }\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll('[data-element]');\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  initEventListners() {\r\n    this.subElements.header.addEventListener('pointerdown', this.onSortClick);\r\n    document.addEventListener('scroll', this.onWindowScroll);\r\n  }\r\n\r\n  async loadData(id, order, start, end) {\r\n    this.url.searchParams.set('_sort', id);\r\n    this.url.searchParams.set('_order', order);\r\n    this.url.searchParams.set('_start', start);\r\n    this.url.searchParams.set('_end', end);\r\n\r\n    this.element.classList.add('sortable-table_loading');\r\n    const data = await fetchJson(this.url);\r\n    this.element.classList.remove('sortable-table_loading');\r\n\r\n    return data;\r\n  }\r\n\r\n  sort(id, order) {\r\n    this.sorted = { id, order };\r\n    this.subElements.header.querySelectorAll('[data-sortable]').forEach(item => {\r\n      item.dataset.order = item.dataset.id === id ? order : '';\r\n    });\r\n    if (this.isSortLocally) {\r\n      this.sortLocally(id, order);\r\n    } else {\r\n      this.sortOnServer(id, order, 1, 1 + this.step);\r\n    }\r\n  }\r\n\r\n  sortLocally(id, order) {\r\n    const sortedData = this.sortData(id, order);\r\n    this.renderRows(sortedData);\r\n  }\r\n\r\n  async sortOnServer(id, order, start, end) {\r\n    this.data = await this.loadData(id, order, start, end);\r\n    this.renderRows(this.data);\r\n  }\r\n\r\n  sortData(id, order) {\r\n    const direction = ({ asc: 1, desc: -1 })[order];\r\n    if (!direction) return this.data;\r\n    const column = this.headerConfig.find(item => item.id === id);\r\n    const { sortType, customSorting } = column;\r\n\r\n    return [...this.data].sort((a, b) => {\r\n      switch (sortType) {\r\n        case 'string':\r\n          return direction * a[id].localeCompare(b[id], ['ru', 'en'], { caseFirst: 'upper' });\r\n        case 'number':\r\n          return direction * (a[id] - b[id]);\r\n        case 'custom':\r\n          return direction * customSorting(a, b);\r\n        default:\r\n          return direction * (a[id] - b[id]);\r\n      }\r\n    });\r\n  }\r\n\r\n  addRows(data) {\r\n    this.data.push(...data);\r\n    const rows = document.createElement('div');\r\n    rows.innerHTML = this.getBody(data);\r\n    this.subElements.body.append(...rows.childNodes);\r\n  }\r\n\r\n  update(data) {\r\n    this.data = data;\r\n    this.renderRows(this.data);\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    document.removeEventListener('scroll', this.onWindowScroll);\r\n    this.subElements = {};\r\n  }\r\n}\r\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","export default class RangePicker {\r\n  element = null;\r\n  subElements = {};\r\n  selectingFrom = true;\r\n  selected = {\r\n    from: new Date(),\r\n    to: new Date()\r\n  };\r\n\r\n  static formatDate(date) {\r\n    return date.toLocaleString('ru', {dateStyle: 'short'});\r\n  }\r\n\r\n  onDocumentClick = event => {\r\n    const isOpen = this.element.classList.contains('rangepicker_open');\r\n    const isRangePicker = this.element.contains(event.target);\r\n\r\n    if (isOpen && !isRangePicker) {\r\n      this.close();\r\n    }\r\n  };\r\n\r\n  constructor({from = new Date(), to = new Date()} = {}) {\r\n    this.showDateFrom = new Date(from);\r\n    this.selected = {from, to};\r\n\r\n    this.render();\r\n  }\r\n\r\n  get template() {\r\n    const from = RangePicker.formatDate(this.selected.from);\r\n    const to = RangePicker.formatDate(this.selected.to);\r\n\r\n    return `<div class=\"rangepicker\">\r\n      <div class=\"rangepicker__input\" data-element=\"input\">\r\n        <span data-element=\"from\">${from}</span> -\r\n        <span data-element=\"to\">${to}</span>\r\n      </div>\r\n      <div class=\"rangepicker__selector\" data-element=\"selector\"></div>\r\n    </div>`;\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(element);\r\n\r\n    this.initEventListeners();\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const subElements = {};\r\n\r\n    for (const subElement of element.querySelectorAll('[data-element]')) {\r\n      subElements[subElement.dataset.element] = subElement;\r\n    }\r\n\r\n    return subElements;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const {input, selector} = this.subElements;\r\n\r\n    document.addEventListener('click', this.onDocumentClick, true);\r\n\r\n    input.addEventListener('click', () => this.toggle());\r\n    selector.addEventListener('click', event => this.onSelectorClick(event));\r\n  }\r\n\r\n  toggle() {\r\n    this.element.classList.toggle('rangepicker_open');\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  onSelectorClick({target}) {\r\n    if (target.classList.contains('rangepicker__cell')) {\r\n      this.onRangePickerCellClick(target);\r\n    }\r\n  }\r\n\r\n  close() {\r\n    this.element.classList.remove('rangepicker_open');\r\n  }\r\n\r\n  renderDateRangePicker() {\r\n    const showDate1 = new Date(this.showDateFrom);\r\n    const showDate2 = new Date(this.showDateFrom);\r\n    const { selector } = this.subElements;\r\n\r\n    showDate2.setMonth(showDate2.getMonth() + 1);\r\n\r\n    selector.innerHTML = `\r\n      <div class=\"rangepicker__selector-arrow\"></div>\r\n      <div class=\"rangepicker__selector-control-left\"></div>\r\n      <div class=\"rangepicker__selector-control-right\"></div>\r\n      ${this.renderCalendar(showDate1)}\r\n      ${this.renderCalendar(showDate2)}\r\n    `;\r\n\r\n    const controlLeft = selector.querySelector('.rangepicker__selector-control-left');\r\n    const controlRight = selector.querySelector('.rangepicker__selector-control-right');\r\n\r\n    controlLeft.addEventListener('click', () => this.prev());\r\n    controlRight.addEventListener('click', () => this.next());\r\n\r\n    this.renderHighlight();\r\n  }\r\n\r\n  prev() {\r\n    this.showDateFrom.setMonth(this.showDateFrom.getMonth() - 1);\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  next() {\r\n    this.showDateFrom.setMonth(this.showDateFrom.getMonth() + 1);\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  renderHighlight() {\r\n    const { from, to } = this.selected;\r\n\r\n    for (const cell of this.element.querySelectorAll('.rangepicker__cell')) {\r\n      const { value } = cell.dataset;\r\n      const cellDate = new Date(value);\r\n\r\n      cell.classList.remove('rangepicker__selected-from');\r\n      cell.classList.remove('rangepicker__selected-between');\r\n      cell.classList.remove('rangepicker__selected-to');\r\n\r\n      if (from && value === from.toISOString()) {\r\n        cell.classList.add('rangepicker__selected-from');\r\n      } else if (to && value === to.toISOString()) {\r\n        cell.classList.add('rangepicker__selected-to');\r\n      } else if (from && to && cellDate >= from && cellDate <= to) {\r\n        cell.classList.add('rangepicker__selected-between');\r\n      }\r\n    }\r\n\r\n    if (from) {\r\n      const selectedFromElem = this.element.querySelector(`[data-value=\"${from.toISOString()}\"]`);\r\n      if (selectedFromElem) {\r\n        selectedFromElem.closest('.rangepicker__cell').classList.add('rangepicker__selected-from');\r\n      }\r\n    }\r\n\r\n    if (to) {\r\n      const selectedToElem = this.element.querySelector(`[data-value=\"${to.toISOString()}\"]`);\r\n      if (selectedToElem) {\r\n        selectedToElem.closest('.rangepicker__cell').classList.add('rangepicker__selected-to');\r\n      }\r\n    }\r\n  }\r\n\r\n  renderCalendar(showDate) {\r\n    const date = new Date(showDate);\r\n    const getGridStartIndex = dayIndex => {\r\n      const index = dayIndex === 0 ? 6 : (dayIndex - 1); // make Sunday (0) the last day\r\n      return index + 1;\r\n    };\r\n\r\n    date.setDate(1);\r\n\r\n    // text-transform: capitalize\r\n    const monthStr = date.toLocaleString('ru', {month: 'long'});\r\n\r\n    let table = `<div class=\"rangepicker__calendar\">\r\n      <div class=\"rangepicker__month-indicator\">\r\n        <time datetime=${monthStr}>${monthStr}</time>\r\n      </div>\r\n      <div class=\"rangepicker__day-of-week\">\r\n        <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div>\r\n      </div>\r\n      <div class=\"rangepicker__date-grid\">\r\n    `;\r\n\r\n    // first day of month starts after a space\r\n    // * * * 1 2 3 4\r\n    table += `\r\n      <button type=\"button\"\r\n        class=\"rangepicker__cell\"\r\n        data-value=\"${date.toISOString()}\"\r\n        style=\"--start-from: ${getGridStartIndex(date.getDay())}\">\r\n          ${date.getDate()}\r\n      </button>`;\r\n\r\n    date.setDate(2);\r\n\r\n    while (date.getMonth() === showDate.getMonth()) {\r\n      table += `\r\n        <button type=\"button\"\r\n          class=\"rangepicker__cell\"\r\n          data-value=\"${date.toISOString()}\">\r\n            ${date.getDate()}\r\n        </button>`;\r\n\r\n      date.setDate(date.getDate() + 1);\r\n    }\r\n\r\n    // close the table\r\n    table += '</div></div>';\r\n\r\n    return table;\r\n  }\r\n\r\n  onRangePickerCellClick(target) {\r\n    const { value } = target.dataset;\r\n\r\n    if (value) {\r\n      const dateValue = new Date(value);\r\n\r\n      if (this.selectingFrom) {\r\n        this.selected = {\r\n          from: dateValue,\r\n          to: null\r\n        };\r\n        this.selectingFrom = false;\r\n        this.renderHighlight();\r\n      } else {\r\n        if (dateValue > this.selected.from) {\r\n          this.selected.to = dateValue;\r\n        } else {\r\n          this.selected.to = this.selected.from;\r\n          this.selected.from = dateValue;\r\n        }\r\n\r\n        this.selectingFrom = true;\r\n        this.renderHighlight();\r\n      }\r\n\r\n      if (this.selected.from && this.selected.to) {\r\n        this.dispatchEvent();\r\n        this.close();\r\n        this.subElements.from.innerHTML = RangePicker.formatDate(this.selected.from);\r\n        this.subElements.to.innerHTML = RangePicker.formatDate(this.selected.to);\r\n      }\r\n    }\r\n  }\r\n\r\n  dispatchEvent() {\r\n    this.element.dispatchEvent(new CustomEvent('date-select', {\r\n      bubbles: true,\r\n      detail: this.selected,\r\n    }));\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    // TODO: Warning! To remove listener  MUST be passes the same event phase\r\n    document.removeEventListener('click', this.onDocumentClick, true);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = {};\r\n    this.selectingFrom = true;\r\n    this.selected = {\r\n      from: new Date(),\r\n      to: new Date()\r\n    };\r\n\r\n    return this;\r\n  }\r\n}\r\n"],"sourceRoot":""}