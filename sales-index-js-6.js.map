{"version":3,"sources":["webpack:///./src/components/sortable-table/index.js","webpack:///./src/components/range-picker/index.js","webpack:///./src/pages/sales/orders-header.js","webpack:///./src/pages/sales/index.js","webpack:///./src/utils/fetch-json.js"],"names":["SortableTable","constructor","headerConfig","url","sorted","id","find","item","sortable","order","isSortLocally","step","start","end","placeholder","rowUrlTemplate","event","column","target","closest","dataset","next","asc","desc","this","sort","async","bottom","element","getBoundingClientRect","document","documentElement","clientHeight","loading","data","loadData","addRows","URL","process","render","filter","key","searchParams","keys","delete","Object","entries","forEach","value","set","subElements","body","innerHTML","renderRows","getHeader","getBody","map","title","join","getRow","row","template","wrapper","createElement","firstElementChild","getSubElements","initEventListners","length","classList","remove","add","querySelectorAll","reduce","accum","subElement","header","addEventListener","onSortClick","onWindowScroll","fetchJson","sortLocally","sortOnServer","sortedData","sortData","direction","sortType","customSorting","a","b","localeCompare","caseFirst","push","rows","append","childNodes","update","destroy","removeEventListener","RangePicker","date","toLocaleString","dateStyle","from","Date","to","isOpen","contains","isRangePicker","close","showDateFrom","selected","formatDate","initEventListeners","input","selector","onDocumentClick","toggle","onSelectorClick","renderDateRangePicker","onRangePickerCellClick","showDate1","showDate2","setMonth","getMonth","renderCalendar","controlLeft","querySelector","controlRight","prev","renderHighlight","cell","cellDate","toISOString","selectedFromElem","selectedToElem","showDate","setDate","monthStr","month","table","dayIndex","getDay","getDate","dateValue","selectingFrom","dispatchEvent","CustomEvent","bubbles","detail","createdAt","toLocaleDateString","year","day","Page","initComponents","renderComponents","rangePicker","ordersContainer","components","component","root","updateComponents","setFilter","createdAt_gte","createdAt_lte","values","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","message","status","Error","super","window","reason","alert"],"mappings":"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","file":"sales-index-js-6.js","sourcesContent":["import fetchJson from '../../utils/fetch-json.js';\r\n\r\nexport default class SortableTable {\r\n  element;\r\n  subElements = {};\r\n  data = [];\r\n  loading = false;\r\n\r\n  onSortClick = event => {\r\n    const column = event.target.closest('[data-sortable]');\r\n    if (column) {\r\n      const { id, order } = column.dataset;\r\n      const next = {\r\n        asc: 'desc',\r\n        desc: 'asc',\r\n        '': 'desc',\r\n      };\r\n      this.sort(id, next[order]);\r\n    }\r\n  };\r\n\r\n  onWindowScroll = async () => {\r\n    const { bottom } = this.element.getBoundingClientRect();\r\n\r\n    if (bottom < document.documentElement.clientHeight && !this.loading && !this.isSortLocally) {\r\n      const { id, order } = this.sorted;\r\n      this.start = this.end;\r\n      this.end = this.start + this.step;\r\n      this.loading = true;\r\n      const data = await this.loadData(id, order, this.start, this.end);\r\n      this.addRows(data);\r\n      this.loading = false;\r\n    }\r\n  };\r\n\r\n  constructor(headerConfig = [], {\r\n    url = '',\r\n    sorted = {\r\n      id: headerConfig.find(item => item.sortable).id,\r\n      order: 'asc',\r\n    },\r\n    isSortLocally = false,\r\n    step = 20,\r\n    start = 0,\r\n    end = start + step,\r\n    placeholder = 'Не найдено',\r\n    rowUrlTemplate = null,\r\n  } = {}) {\r\n    this.headerConfig = headerConfig;\r\n    this.url = new URL(url, process.env.BACKEND_URL);\r\n    this.sorted = sorted;\r\n    this.isSortLocally = isSortLocally;\r\n    this.step = step;\r\n    this.start = start;\r\n    this.end = end;\r\n    this.placeholder = placeholder;\r\n    this.rowUrlTemplate = rowUrlTemplate;\r\n\r\n    this.render();\r\n  }\r\n\r\n  async setFilter(filter = {}) {\r\n    for (const key of this.url.searchParams.keys()) {\r\n      this.url.searchParams.delete(key);\r\n    }\r\n    Object.entries(filter).forEach(([key, value]) => {\r\n      this.url.searchParams.set(key, value);\r\n    });\r\n    const { id, order } = this.sorted;\r\n    this.start = 0;\r\n    this.end = this.start + this.step;\r\n    this.subElements.body.innerHTML = '';\r\n    this.data = await this.loadData(id, order, this.start, this.end);\r\n    this.renderRows(this.data);\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"sortable-table\">\r\n        <div data-element=\"header\" class=\"sortable-table__header sortable-table__row\">\r\n          ${this.getHeader()}\r\n        </div>\r\n        <div data-element=\"body\" class=\"sortable-table__body\">\r\n          ${this.getBody()}\r\n        </div>\r\n        <div data-element=\"loading\" class=\"loading-line sortable-table__loading-line\"></div>\r\n        <div data-element=\"emptyPlaceholder\" class=\"sortable-table__empty-placeholder\">${this.placeholder}</div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getHeader() {\r\n    return this.headerConfig.map(item => `\r\n      <div class=\"sortable-table__cell\" data-id=\"${item.id}\" ${item.sortable ? 'data-sortable' : ''} data-order=\"${item.id === this.sorted.id ? this.sorted.order : ''}\">\r\n        <span>${item.title}</span>\r\n        <span data-element=\"arrow\" class=\"sortable-table__sort-arrow\">\r\n          <span class=\"sort-arrow\"></span>\r\n        </span>\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  getBody(data = []) {\r\n    if (this.rowUrlTemplate) {\r\n      return data.map(item => `\r\n        <a href=\"${this.rowUrlTemplate(item)}\" class=\"sortable-table__row\">\r\n          ${this.getRow(item)}\r\n        </a>\r\n      `).join('');\r\n    } else {\r\n      return data.map(item => `\r\n        <div class=\"sortable-table__row\">\r\n          ${this.getRow(item)}\r\n        </div>\r\n      `).join('');\r\n    }\r\n  }\r\n\r\n  getRow(row) {\r\n    return this.headerConfig.map(item => item.template ? item.template(row[item.id]) : `\r\n      <div class=\"sortable-table__cell\">${row[item.id]}</div>\r\n    `).join('');\r\n  }\r\n\r\n  async render() {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n    \r\n    this.subElements = this.getSubElements();\r\n\r\n    const { id, order } = this.sorted;\r\n    this.data = await this.loadData(id, order, this.start, this.end);\r\n    this.renderRows(this.data);\r\n\r\n    this.initEventListners();\r\n  }\r\n\r\n  renderRows(data) {\r\n    if (data.length) {\r\n      this.element.classList.remove('sortable-table_empty');\r\n      this.subElements.body.innerHTML = this.getBody(data);\r\n    } else {\r\n      this.element.classList.add('sortable-table_empty');\r\n    }\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll('[data-element]');\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  initEventListners() {\r\n    this.subElements.header.addEventListener('pointerdown', this.onSortClick);\r\n    document.addEventListener('scroll', this.onWindowScroll);\r\n  }\r\n\r\n  async loadData(id, order, start, end) {\r\n    this.url.searchParams.set('_sort', id);\r\n    this.url.searchParams.set('_order', order);\r\n    this.url.searchParams.set('_start', start);\r\n    this.url.searchParams.set('_end', end);\r\n\r\n    this.element.classList.add('sortable-table_loading');\r\n    const data = await fetchJson(this.url);\r\n    this.element.classList.remove('sortable-table_loading');\r\n\r\n    return data;\r\n  }\r\n\r\n  sort(id, order) {\r\n    this.sorted = { id, order };\r\n    this.subElements.header.querySelectorAll('[data-sortable]').forEach(item => {\r\n      item.dataset.order = item.dataset.id === id ? order : '';\r\n    });\r\n    if (this.isSortLocally) {\r\n      this.sortLocally(id, order);\r\n    } else {\r\n      this.sortOnServer(id, order, 1, 1 + this.step);\r\n    }\r\n  }\r\n\r\n  sortLocally(id, order) {\r\n    const sortedData = this.sortData(id, order);\r\n    this.renderRows(sortedData);\r\n  }\r\n\r\n  async sortOnServer(id, order, start, end) {\r\n    this.data = await this.loadData(id, order, start, end);\r\n    this.renderRows(this.data);\r\n  }\r\n\r\n  sortData(id, order) {\r\n    const direction = ({ asc: 1, desc: -1 })[order];\r\n    if (!direction) return this.data;\r\n    const column = this.headerConfig.find(item => item.id === id);\r\n    const { sortType, customSorting } = column;\r\n\r\n    return [...this.data].sort((a, b) => {\r\n      switch (sortType) {\r\n        case 'string':\r\n          return direction * a[id].localeCompare(b[id], ['ru', 'en'], { caseFirst: 'upper' });\r\n        case 'number':\r\n          return direction * (a[id] - b[id]);\r\n        case 'custom':\r\n          return direction * customSorting(a, b);\r\n        default:\r\n          return direction * (a[id] - b[id]);\r\n      }\r\n    });\r\n  }\r\n\r\n  addRows(data) {\r\n    this.data.push(...data);\r\n    const rows = document.createElement('div');\r\n    rows.innerHTML = this.getBody(data);\r\n    this.subElements.body.append(...rows.childNodes);\r\n  }\r\n\r\n  update(data) {\r\n    this.data = data;\r\n    this.renderRows(this.data);\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    document.removeEventListener('scroll', this.onWindowScroll);\r\n    this.subElements = {};\r\n  }\r\n}\r\n","export default class RangePicker {\r\n  element = null;\r\n  subElements = {};\r\n  selectingFrom = true;\r\n  selected = {\r\n    from: new Date(),\r\n    to: new Date()\r\n  };\r\n\r\n  static formatDate(date) {\r\n    return date.toLocaleString('ru', {dateStyle: 'short'});\r\n  }\r\n\r\n  onDocumentClick = event => {\r\n    const isOpen = this.element.classList.contains('rangepicker_open');\r\n    const isRangePicker = this.element.contains(event.target);\r\n\r\n    if (isOpen && !isRangePicker) {\r\n      this.close();\r\n    }\r\n  };\r\n\r\n  constructor({from = new Date(), to = new Date()} = {}) {\r\n    this.showDateFrom = new Date(from);\r\n    this.selected = {from, to};\r\n\r\n    this.render();\r\n  }\r\n\r\n  get template() {\r\n    const from = RangePicker.formatDate(this.selected.from);\r\n    const to = RangePicker.formatDate(this.selected.to);\r\n\r\n    return `<div class=\"rangepicker\">\r\n      <div class=\"rangepicker__input\" data-element=\"input\">\r\n        <span data-element=\"from\">${from}</span> -\r\n        <span data-element=\"to\">${to}</span>\r\n      </div>\r\n      <div class=\"rangepicker__selector\" data-element=\"selector\"></div>\r\n    </div>`;\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(element);\r\n\r\n    this.initEventListeners();\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const subElements = {};\r\n\r\n    for (const subElement of element.querySelectorAll('[data-element]')) {\r\n      subElements[subElement.dataset.element] = subElement;\r\n    }\r\n\r\n    return subElements;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const {input, selector} = this.subElements;\r\n\r\n    document.addEventListener('click', this.onDocumentClick, true);\r\n\r\n    input.addEventListener('click', () => this.toggle());\r\n    selector.addEventListener('click', event => this.onSelectorClick(event));\r\n  }\r\n\r\n  toggle() {\r\n    this.element.classList.toggle('rangepicker_open');\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  onSelectorClick({target}) {\r\n    if (target.classList.contains('rangepicker__cell')) {\r\n      this.onRangePickerCellClick(target);\r\n    }\r\n  }\r\n\r\n  close() {\r\n    this.element.classList.remove('rangepicker_open');\r\n  }\r\n\r\n  renderDateRangePicker() {\r\n    const showDate1 = new Date(this.showDateFrom);\r\n    const showDate2 = new Date(this.showDateFrom);\r\n    const { selector } = this.subElements;\r\n\r\n    showDate2.setMonth(showDate2.getMonth() + 1);\r\n\r\n    selector.innerHTML = `\r\n      <div class=\"rangepicker__selector-arrow\"></div>\r\n      <div class=\"rangepicker__selector-control-left\"></div>\r\n      <div class=\"rangepicker__selector-control-right\"></div>\r\n      ${this.renderCalendar(showDate1)}\r\n      ${this.renderCalendar(showDate2)}\r\n    `;\r\n\r\n    const controlLeft = selector.querySelector('.rangepicker__selector-control-left');\r\n    const controlRight = selector.querySelector('.rangepicker__selector-control-right');\r\n\r\n    controlLeft.addEventListener('click', () => this.prev());\r\n    controlRight.addEventListener('click', () => this.next());\r\n\r\n    this.renderHighlight();\r\n  }\r\n\r\n  prev() {\r\n    this.showDateFrom.setMonth(this.showDateFrom.getMonth() - 1);\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  next() {\r\n    this.showDateFrom.setMonth(this.showDateFrom.getMonth() + 1);\r\n    this.renderDateRangePicker();\r\n  }\r\n\r\n  renderHighlight() {\r\n    const { from, to } = this.selected;\r\n\r\n    for (const cell of this.element.querySelectorAll('.rangepicker__cell')) {\r\n      const { value } = cell.dataset;\r\n      const cellDate = new Date(value);\r\n\r\n      cell.classList.remove('rangepicker__selected-from');\r\n      cell.classList.remove('rangepicker__selected-between');\r\n      cell.classList.remove('rangepicker__selected-to');\r\n\r\n      if (from && value === from.toISOString()) {\r\n        cell.classList.add('rangepicker__selected-from');\r\n      } else if (to && value === to.toISOString()) {\r\n        cell.classList.add('rangepicker__selected-to');\r\n      } else if (from && to && cellDate >= from && cellDate <= to) {\r\n        cell.classList.add('rangepicker__selected-between');\r\n      }\r\n    }\r\n\r\n    if (from) {\r\n      const selectedFromElem = this.element.querySelector(`[data-value=\"${from.toISOString()}\"]`);\r\n      if (selectedFromElem) {\r\n        selectedFromElem.closest('.rangepicker__cell').classList.add('rangepicker__selected-from');\r\n      }\r\n    }\r\n\r\n    if (to) {\r\n      const selectedToElem = this.element.querySelector(`[data-value=\"${to.toISOString()}\"]`);\r\n      if (selectedToElem) {\r\n        selectedToElem.closest('.rangepicker__cell').classList.add('rangepicker__selected-to');\r\n      }\r\n    }\r\n  }\r\n\r\n  renderCalendar(showDate) {\r\n    const date = new Date(showDate);\r\n    const getGridStartIndex = dayIndex => {\r\n      const index = dayIndex === 0 ? 6 : (dayIndex - 1); // make Sunday (0) the last day\r\n      return index + 1;\r\n    };\r\n\r\n    date.setDate(1);\r\n\r\n    // text-transform: capitalize\r\n    const monthStr = date.toLocaleString('ru', {month: 'long'});\r\n\r\n    let table = `<div class=\"rangepicker__calendar\">\r\n      <div class=\"rangepicker__month-indicator\">\r\n        <time datetime=${monthStr}>${monthStr}</time>\r\n      </div>\r\n      <div class=\"rangepicker__day-of-week\">\r\n        <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div>\r\n      </div>\r\n      <div class=\"rangepicker__date-grid\">\r\n    `;\r\n\r\n    // first day of month starts after a space\r\n    // * * * 1 2 3 4\r\n    table += `\r\n      <button type=\"button\"\r\n        class=\"rangepicker__cell\"\r\n        data-value=\"${date.toISOString()}\"\r\n        style=\"--start-from: ${getGridStartIndex(date.getDay())}\">\r\n          ${date.getDate()}\r\n      </button>`;\r\n\r\n    date.setDate(2);\r\n\r\n    while (date.getMonth() === showDate.getMonth()) {\r\n      table += `\r\n        <button type=\"button\"\r\n          class=\"rangepicker__cell\"\r\n          data-value=\"${date.toISOString()}\">\r\n            ${date.getDate()}\r\n        </button>`;\r\n\r\n      date.setDate(date.getDate() + 1);\r\n    }\r\n\r\n    // close the table\r\n    table += '</div></div>';\r\n\r\n    return table;\r\n  }\r\n\r\n  onRangePickerCellClick(target) {\r\n    const { value } = target.dataset;\r\n\r\n    if (value) {\r\n      const dateValue = new Date(value);\r\n\r\n      if (this.selectingFrom) {\r\n        this.selected = {\r\n          from: dateValue,\r\n          to: null\r\n        };\r\n        this.selectingFrom = false;\r\n        this.renderHighlight();\r\n      } else {\r\n        if (dateValue > this.selected.from) {\r\n          this.selected.to = dateValue;\r\n        } else {\r\n          this.selected.to = this.selected.from;\r\n          this.selected.from = dateValue;\r\n        }\r\n\r\n        this.selectingFrom = true;\r\n        this.renderHighlight();\r\n      }\r\n\r\n      if (this.selected.from && this.selected.to) {\r\n        this.dispatchEvent();\r\n        this.close();\r\n        this.subElements.from.innerHTML = RangePicker.formatDate(this.selected.from);\r\n        this.subElements.to.innerHTML = RangePicker.formatDate(this.selected.to);\r\n      }\r\n    }\r\n  }\r\n\r\n  dispatchEvent() {\r\n    this.element.dispatchEvent(new CustomEvent('date-select', {\r\n      bubbles: true,\r\n      detail: this.selected,\r\n    }));\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    // TODO: Warning! To remove listener  MUST be passes the same event phase\r\n    document.removeEventListener('click', this.onDocumentClick, true);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = {};\r\n    this.selectingFrom = true;\r\n    this.selected = {\r\n      from: new Date(),\r\n      to: new Date()\r\n    };\r\n\r\n    return this;\r\n  }\r\n}\r\n","const header = [\r\n  {\r\n    id: 'id',\r\n    title: 'ID',\r\n    sortable: true,\r\n    sortType: 'number'\r\n  },\r\n  {\r\n    id: 'user',\r\n    title: 'Клиент',\r\n    sortable: true,\r\n    sortType: 'string'\r\n  },\r\n  {\r\n    id: 'createdAt',\r\n    title: 'Дата',\r\n    sortable: true,\r\n    sortType: 'custom',\r\n    customSorting: (a, b) => new Date(b.createdAt) - new Date(a.createdAt),\r\n    template: data => `\r\n      <div class=\"sortable-table__cell\">\r\n        ${(new Date(data)).toLocaleDateString('ru-RU', { year: 'numeric', month: 'short', day: 'numeric' })}\r\n      </div>\r\n    `\r\n  },\r\n  {\r\n    id: 'totalCost',\r\n    title: 'Стоимость',\r\n    sortable: true,\r\n    sortType: 'number',\r\n    template: data => `\r\n      <div class=\"sortable-table__cell\">\r\n        $${data.toLocaleString('en-US')}\r\n      </div>\r\n    `\r\n  },\r\n  {\r\n    id: 'delivery',\r\n    title: 'Статус',\r\n    sortable: true,\r\n    sortType: 'string'\r\n  },\r\n];\r\n\r\nexport default header;","import RangePicker from '../../components/range-picker';\r\nimport SortableTable from '../../components/sortable-table';\r\nimport header from './orders-header.js';\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"sales\">\r\n        <div class=\"content__top-panel\">\r\n          <h2 class=\"page-title\">Продажи</h2>\r\n          <div data-element=\"rangePicker\"></div>\r\n        </div>\r\n        <div data-element=\"ordersContainer\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  render() {\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements();\r\n\r\n    this.initComponents();\r\n    this.renderComponents();\r\n    this.initEventListners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  initComponents() {    \r\n    const to = new Date();\r\n    const from = new Date();\r\n    from.setMonth(from.getMonth() - 1);\r\n\r\n    const rangePicker = new RangePicker({ from, to });\r\n\r\n    const ordersContainer = new SortableTable(header, {\r\n      url: `api/rest/orders?createdAt_gte=${from.toISOString()}&createdAt_lte=${to.toISOString()}`,\r\n      sorted: {\r\n        id: 'createdAt',\r\n        order: 'desc',\r\n      },\r\n    });\r\n\r\n    this.components = {\r\n      rangePicker,\r\n      ordersContainer,\r\n    };\r\n  }\r\n\r\n  renderComponents() {\r\n    Object.keys(this.components).forEach(component => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n\r\n      root.append(element);\r\n    });\r\n  }\r\n\r\n  initEventListners() {\r\n    this.components.rangePicker.element.addEventListener('date-select', event => {\r\n      const { from, to } = event.detail;\r\n\r\n      this.updateComponents(from, to);\r\n    });\r\n  }\r\n\r\n  updateComponents(from, to) {\r\n    this.components.ordersContainer.setFilter({\r\n      createdAt_gte: from.toISOString(),\r\n      createdAt_lte: to.toISOString(),\r\n    });\r\n  }\r\n\r\n  getSubElements() {\r\n    const elements = this.element.querySelectorAll('[data-element]');\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n\r\n    this.remove();\r\n\r\n    this.element = null;\r\n    this.subElements = null;\r\n    this.components = null;\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}