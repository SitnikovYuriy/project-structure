(window.webpackJsonp=window.webpackJsonp||[]).push([[5],[,,,,,function(t,e,s){"use strict";function n(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}s.r(e),s.d(e,"default",(function(){return d}));class i{constructor({min:t=100,max:e=200,formatValue:s=(t=>"$"+t),selected:i={from:t,to:e}}={}){n(this,"element",void 0),n(this,"subElements",{}),n(this,"onThumbPointerMove",t=>{t.preventDefault();const{left:e,right:s,width:n}=this.subElements.inner.getBoundingClientRect();if(this.dragging===this.subElements.thumbLeft){let s=(t.clientX-e+this.shiftX)/n;s<0&&(s=0),s*=100;const i=parseFloat(this.subElements.thumbRight.style.right);s+i>100&&(s=100-i),this.dragging.style.left=this.subElements.progress.style.left=s+"%",this.subElements.from.innerHTML=this.formatValue(this.getValue().from)}if(this.dragging===this.subElements.thumbRight){let e=(s-t.clientX-this.shiftX)/n;e<0&&(e=0),e*=100;const i=parseFloat(this.subElements.thumbLeft.style.left);i+e>100&&(e=100-i),this.dragging.style.right=this.subElements.progress.style.right=e+"%",this.subElements.to.innerHTML=this.formatValue(this.getValue().to)}}),n(this,"onThumbPointerUp",()=>{this.element.classList.remove("range-slider_dragging"),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp),this.element.dispatchEvent(new CustomEvent("range-select",{detail:this.getValue(),bubbles:!0}))}),this.min=t,this.max=e,this.formatValue=s,this.selected=i,this.render()}get template(){const{from:t,to:e}=this.selected;return`<div class="range-slider">\n      <span data-element="from">${this.formatValue(t)}</span>\n      <div data-element="inner" class="range-slider__inner">\n        <span data-element="progress" class="range-slider__progress"></span>\n        <span data-element="thumbLeft" class="range-slider__thumb-left"></span>\n        <span data-element="thumbRight" class="range-slider__thumb-right"></span>\n      </div>\n      <span data-element="to">${this.formatValue(e)}</span>\n    </div>`}render(){const t=document.createElement("div");t.innerHTML=this.template,this.element=t.firstElementChild,this.element.ondragstart=()=>!1,this.subElements=this.getSubElements(t),this.initEventListeners(),this.update()}initEventListeners(){const{thumbLeft:t,thumbRight:e}=this.subElements;t.addEventListener("pointerdown",t=>this.onThumbPointerDown(t)),e.addEventListener("pointerdown",t=>this.onThumbPointerDown(t))}getSubElements(t){return[...t.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp)}update(){const t=this.max-this.min,e=Math.floor((this.selected.from-this.min)/t*100)+"%",s=Math.floor((this.max-this.selected.to)/t*100)+"%";this.subElements.progress.style.left=e,this.subElements.progress.style.right=s,this.subElements.thumbLeft.style.left=e,this.subElements.thumbRight.style.right=s}onThumbPointerDown(t){const e=t.target;t.preventDefault();const{left:s,right:n}=e.getBoundingClientRect();e===this.subElements.thumbLeft?this.shiftX=n-t.clientX:this.shiftX=s-t.clientX,this.dragging=e,this.element.classList.add("range-slider_dragging"),document.addEventListener("pointermove",this.onThumbPointerMove),document.addEventListener("pointerup",this.onThumbPointerUp)}getValue(){const t=this.max-this.min,{left:e}=this.subElements.thumbLeft.style,{right:s}=this.subElements.thumbRight.style;return{from:Math.round(this.min+.01*parseFloat(e)*t),to:Math.round(this.max-.01*parseFloat(s)*t)}}}var r=s(10),a=s(11);var l=[{id:"images",title:"Фото",sortable:!1,template:t=>`\n        <div class="sortable-table__cell">\n          <img class="sortable-table-image" alt="Image" src="${t[0].url}">\n        </div>\n      `},{id:"title",title:"Название",sortable:!0,sortType:"string"},{id:"subcategory",title:"Категория",sortable:!1,template:t=>{return`\n        <div class="sortable-table__cell">\n          <span data-tooltip="${Object(a.a)((e=t.category.title,s=t.title,`\n  <div class="sortable-table-tooltip">\n    <span class="sortable-table-tooltip__category">${e}</span> / <b class="sortable-table-tooltip__subcategory">${s}</b>\n  </div>\n`))}">${t.title}</span>\n        </div>\n      `;var e,s}},{id:"quantity",title:"Количество",sortable:!0,sortType:"number"},{id:"price",title:"Цена",sortable:!0,sortType:"number",template:t=>`\n      <div class="sortable-table__cell">\n        $${t.toLocaleString("en-US")}\n      </div>\n    `},{id:"status",title:"Статус",sortable:!0,sortType:"number",template:t=>`<div class="sortable-table__cell">\n        ${t>0?"Активен":"Неактивен"}\n      </div>`}];function o(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class d{constructor(){o(this,"element",void 0),o(this,"subElements",{}),o(this,"components",{}),o(this,"filter",{_embed:"subcategory.category"})}get template(){return'\n      <div class="products-list">\n        <div class="content__top-panel">\n          <h2 class="page-title">Товары</h2>\n          <a href="/project-structure/products/add" class="button-primary">Добавить товар</a>\n        </div>\n        <div class="content-box content-box_small">\n          <form class="form-inline">\n            <div class="form-group">\n              <label class="form-label">Сортировать по:</label>\n              <input type="text" data-element="filterName" class="form-control" placeholder="Название товара">\n            </div>\n            <div class="form-group" data-element="sliderContainer">\n              <label class="form-label">Цена:</label>\n            </div>\n            <div class="form-group">\n              <label class="form-label">Статус:</label>\n              <select class="form-control" data-element="filterStatus">\n                <option value="" selected="">Любой</option>\n                <option value="1">Активный</option>\n                <option value="0">Неактивный</option>\n              </select>\n            </div>\n          </form>\n        </div>\n        <div data-element="productsContainer" class="products-list__container"></div>\n      </div>\n    '}render(){const t=document.createElement("div");return t.innerHTML=this.template,this.element=t.firstElementChild,this.subElements=this.getSubElements(),this.initComponents(),this.renderComponents(),this.initEventListners(),this.element}initComponents(){const t=new i({min:0,max:4e3}),e=new r.a(l,{url:"api/rest/products?_embed=subcategory.category",sorted:{id:"title",order:"asc"},start:0,end:30,step:30,placeholder:"\n        <div>\n          <p>Не найдено товаров удовлетворяющих выбранному критерию</p>\n        </div>\n      ",rowUrlTemplate:t=>"/project-structure/products/"+t.id});this.components={sliderContainer:t,productsContainer:e}}renderComponents(){Object.keys(this.components).forEach(t=>{const e=this.subElements[t],{element:s}=this.components[t];e.append(s)})}initEventListners(){let t;this.components.sliderContainer.element.addEventListener("range-select",t=>{const{from:e,to:s}=t.detail;this.filter.price_gte=e,this.filter.price_lte=s,this.updateComponents()}),this.subElements.filterName.addEventListener("keyup",()=>{clearTimeout(t),t=setTimeout(()=>{const t=this.subElements.filterName.value.trim();t!==this.filter.title_like&&(this.filter.title_like=t,this.updateComponents())},1e3)}),this.subElements.filterStatus.addEventListener("change",()=>{const{value:t}=this.subElements.filterStatus;""===t?delete this.filter.status:this.filter.status=t,this.updateComponents()})}updateComponents(){this.components.productsContainer.setFilter(this.filter)}getSubElements(){return[...this.element.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}remove(){this.element.remove()}destroy(){for(const t of Object.values(this.components))t.destroy();this.remove(),this.element=null,this.subElements=null,this.components=null}}},,,,function(t,e,s){"use strict";e.a=async function(t,e){let s,i;try{s=await fetch(t.toString(),e)}catch(t){throw new n(s,"Network error has occurred.")}if(!s.ok){let t=s.statusText;try{i=await s.json(),t=i.error&&i.error.message||i.data&&i.data.error&&i.data.error.message||t}catch(t){}let e=`Error ${s.status}: ${t}`;throw new n(s,i,e)}try{return await s.json()}catch(t){throw new n(s,null,t.message)}};class n extends Error{constructor(t,e,s){var n,i,r;super(s),r="FetchError",(i="name")in(n=this)?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,this.response=t,this.body=e}}window.addEventListener("unhandledrejection",t=>{t.reason instanceof n&&alert(t.reason.message)})},function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var n=s(9);function i(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class r{constructor(t=[],{url:e="",sorted:s={id:t.find(t=>t.sortable).id,order:"asc"},isSortLocally:n=!1,step:r=20,start:a=0,end:l=a+r,placeholder:o="Не найдено",rowUrlTemplate:d=null}={}){i(this,"element",void 0),i(this,"subElements",{}),i(this,"data",[]),i(this,"loading",!1),i(this,"onSortClick",t=>{const e=t.target.closest("[data-sortable]");if(e){const{id:t,order:s}=e.dataset,n={asc:"desc",desc:"asc","":"desc"};this.sort(t,n[s])}}),i(this,"onWindowScroll",async()=>{const{bottom:t}=this.element.getBoundingClientRect();if(t<document.documentElement.clientHeight&&!this.loading&&!this.isSortLocally){const{id:t,order:e}=this.sorted;this.start=this.end,this.end=this.start+this.step,this.loading=!0;const s=await this.loadData(t,e,this.start,this.end);this.addRows(s),this.loading=!1}}),this.headerConfig=t,this.url=new URL(e,"https://course-js.javascript.ru/"),this.sorted=s,this.isSortLocally=n,this.step=r,this.start=a,this.end=l,this.placeholder=o,this.rowUrlTemplate=d,this.render()}async setFilter(t={}){for(const t of this.url.searchParams.keys())this.url.searchParams.delete(t);Object.entries(t).forEach(([t,e])=>{this.url.searchParams.set(t,e)});const{id:e,order:s}=this.sorted;this.start=0,this.end=this.start+this.step,this.subElements.body.innerHTML="",this.data=await this.loadData(e,s,this.start,this.end),this.renderRows(this.data)}get template(){return`\n      <div class="sortable-table">\n        <div data-element="header" class="sortable-table__header sortable-table__row">\n          ${this.getHeader()}\n        </div>\n        <div data-element="body" class="sortable-table__body">\n          ${this.getBody()}\n        </div>\n        <div data-element="loading" class="loading-line sortable-table__loading-line"></div>\n        <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder">${this.placeholder}</div>\n      </div>\n    `}getHeader(){return this.headerConfig.map(t=>`\n      <div class="sortable-table__cell" data-id="${t.id}" ${t.sortable?"data-sortable":""} data-order="${t.id===this.sorted.id?this.sorted.order:""}">\n        <span>${t.title}</span>\n        <span data-element="arrow" class="sortable-table__sort-arrow">\n          <span class="sort-arrow"></span>\n        </span>\n      </div>\n    `).join("")}getBody(t=[]){return this.rowUrlTemplate?t.map(t=>`\n        <a href="${this.rowUrlTemplate(t)}" class="sortable-table__row">\n          ${this.getRow(t)}\n        </a>\n      `).join(""):t.map(t=>`\n        <div class="sortable-table__row">\n          ${this.getRow(t)}\n        </div>\n      `).join("")}getRow(t){return this.headerConfig.map(e=>e.template?e.template(t[e.id]):`\n      <div class="sortable-table__cell">${t[e.id]}</div>\n    `).join("")}async render(){const t=document.createElement("div");t.innerHTML=this.template,this.element=t.firstElementChild,this.subElements=this.getSubElements();const{id:e,order:s}=this.sorted;this.data=await this.loadData(e,s,this.start,this.end),this.renderRows(this.data),this.initEventListners()}renderRows(t){t.length?(this.element.classList.remove("sortable-table_empty"),this.subElements.body.innerHTML=this.getBody(t)):this.element.classList.add("sortable-table_empty")}getSubElements(){return[...this.element.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}initEventListners(){this.subElements.header.addEventListener("pointerdown",this.onSortClick),document.addEventListener("scroll",this.onWindowScroll)}async loadData(t,e,s,i){this.url.searchParams.set("_sort",t),this.url.searchParams.set("_order",e),this.url.searchParams.set("_start",s),this.url.searchParams.set("_end",i),this.element.classList.add("sortable-table_loading");const r=await Object(n.a)(this.url);return this.element.classList.remove("sortable-table_loading"),r}sort(t,e){this.sorted={id:t,order:e},this.subElements.header.querySelectorAll("[data-sortable]").forEach(s=>{s.dataset.order=s.dataset.id===t?e:""}),this.isSortLocally?this.sortLocally(t,e):this.sortOnServer(t,e,1,1+this.step)}sortLocally(t,e){const s=this.sortData(t,e);this.renderRows(s)}async sortOnServer(t,e,s,n){this.data=await this.loadData(t,e,s,n),this.renderRows(this.data)}sortData(t,e){const s={asc:1,desc:-1}[e];if(!s)return this.data;const n=this.headerConfig.find(e=>e.id===t),{sortType:i,customSorting:r}=n;return[...this.data].sort((e,n)=>{switch(i){case"string":return s*e[t].localeCompare(n[t],["ru","en"],{caseFirst:"upper"});case"number":return s*(e[t]-n[t]);case"custom":return s*r(e,n);default:return s*(e[t]-n[t])}})}addRows(t){this.data.push(...t);const e=document.createElement("div");e.innerHTML=this.getBody(t),this.subElements.body.append(...e.childNodes)}update(t){this.data=t,this.renderRows(this.data)}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("scroll",this.onWindowScroll),this.subElements={}}}},function(t,e,s){"use strict";e.a=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}]]);
//# sourceMappingURL=products-list-index-js-5.js.map